<!-- frontend/src/app/products/products.html - Updated with cart functionality -->
<div class="products-container">
  <div class="container">
    <header class="page-header">
      <h1>Our Fresh Products</h1>
      <p>Discover our delicious selection of freshly baked goods</p>

      <!-- Cart Summary -->
      <div class="cart-summary-header" *ngIf="!cartService.isEmpty()">
        <div class="cart-info">
          <span class="cart-count">{{ cartService.itemCount() }} items in cart</span>
          <span class="cart-total">{{ '$' + cartService.total().toFixed(2) }}</span>
        </div>
        <a routerLink="/cart" class="btn btn-outline btn-sm">
          üõí View Cart
        </a>
      </div>
    </header>

    <div class="filters">
      <div class="filter-group">
        <label for="category">Category:</label>
        <select id="category" [(ngModel)]="selectedCategory" (change)="filterProducts()">
          <option value="">All Categories</option>
          <option *ngFor="let category of productService.categories()" [value]="category">{{category}}</option>
        </select>
      </div>

      <div class="search-group">
        <label for="search">Search:</label>
        <input
          id="search"
          type="text"
          placeholder="Search products..."
          [(ngModel)]="searchTerm"
          (input)="filterProducts()"
        />
      </div>
    </div>

    <div class="products-grid" *ngIf="!productService.isLoading(); else loadingTemplate">
      <div class="product-card" *ngFor="let product of filteredProducts()">
        <div class="product-image">
          <img [src]="product.imageUrl || '/assets/images/default-product.jpg'"
               [alt]="product.name"
               (error)="onImageError($event)">
          <div class="product-category">{{product.category}}</div>

          <!-- Stock indicator -->
          <div class="stock-indicator" *ngIf="product.stock < 10 && product.available">
            Only {{ product.stock }} left!
          </div>
        </div>

        <div class="product-info">
          <h3>{{product.name}}</h3>
          <p class="product-description">{{product.description}}</p>

          <!-- Cart Status -->
          <div class="cart-status" *ngIf="isInCart(product._id)">
            <span class="in-cart-indicator">
              ‚úì {{ getCartQuantity(product._id) }} in cart
            </span>
          </div>

          <div class="product-footer">
            <span class="product-price">${{product.price.toFixed(2)}}</span>

            <div class="product-actions">
              <!-- Add to Cart Button -->
              <button
                class="add-to-cart-btn"
                [class.unavailable]="!product.available"
                [class.in-cart]="isInCart(product._id)"
                [disabled]="!product.available || (product.stock && product.stock <= 0)"
                (click)="addToCart(product)"
              >
                <span *ngIf="product.available && (!product.stock || product.stock > 0)">
                  {{ isInCart(product._id) ? 'Add More' : 'Add to Cart' }}
                </span>
                <span *ngIf="!product.available">Unavailable</span>
                <span *ngIf="product.available && product.stock && product.stock <= 0">Out of Stock</span>
              </button>

              <!-- Quick View Button (Future Enhancement) -->
              <!-- <button class="quick-view-btn" title="Quick View">
                üëÅÔ∏è
              </button> -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #loadingTemplate>
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading our delicious products...</p>
      </div>
    </ng-template>

    <div class="no-products" *ngIf="!productService.isLoading() && filteredProducts().length === 0">
      <h3>No products found</h3>
      <p *ngIf="searchTerm() || selectedCategory()">
        Try adjusting your filters or search terms.
      </p>
      <p *ngIf="!searchTerm() && !selectedCategory()">
        We're currently updating our product catalog. Please check back soon!
      </p>

      <button class="btn btn-secondary" (click)="searchTerm.set(''); selectedCategory.set(''); filterProducts()" *ngIf="searchTerm() || selectedCategory()">
        Clear Filters
      </button>
    </div>

    <!-- Cart Float Button for Mobile -->
    <div class="cart-float" *ngIf="!cartService.isEmpty()">
      <a routerLink="/cart" class="cart-float-btn">
        <span class="cart-icon">üõí</span>
        <span class="cart-count-badge">{{ cartService.itemCount() }}</span>
      </a>
    </div>
  </div>
</div>
