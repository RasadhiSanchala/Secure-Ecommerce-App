<div class="orders-container">
  <div class="container">
    <header class="page-header">
      <h1>{{ isAdmin() ? 'All Orders' : 'My Orders' }}</h1>
      <p>{{ isAdmin() ? 'Manage customer orders' : 'Track your order history' }}</p>
    </header>

    <div class="orders-stats" *ngIf="isAdmin()">
      <div class="stat-card">
        <h3>{{ orderStats().total }}</h3>
        <p>Total Orders</p>
      </div>
      <div class="stat-card">
        <h3>{{ orderStats().pending }}</h3>
        <p>Pending Orders</p>
      </div>
      <div class="stat-card">
        <h3>{{ orderStats().delivered }}</h3>
        <p>Delivered Orders</p>
      </div>
      <div class="stat-card">
        <h3>${{ orderStats().totalRevenue.toFixed(2) }}</h3>
        <p>Total Revenue</p>
      </div>
    </div>

    <div class="orders-filters" *ngIf="isAdmin()">
      <select [(ngModel)]="selectedStatus" (change)="filterOrders()">
        <option value="">All Statuses</option>
        <option value="pending">Pending</option>
        <option value="processing">Processing</option>
        <option value="shipped">Shipped</option>
        <option value="delivered">Delivered</option>
        <option value="cancelled">Cancelled</option>
      </select>
    </div>

    <div class="orders-grid" *ngIf="!orderService.isLoading(); else loadingTemplate">
      <div class="order-card" *ngFor="let order of filteredOrders()">
        <div class="order-header">
          <div class="order-id">
            <h3>Order #{{ order._id.slice(-8).toUpperCase() }}</h3>
            <p class="order-date">{{ formatDate(order.createdAt) }}</p>
          </div>
          <div class="order-status">
                <span class="status-badge" [style.background-color]="getStatusColor(order.status)">
                  {{ getStatusText(order.status) }}
                </span>
          </div>
        </div>

        <div class="order-customer" *ngIf="isAdmin()">
          <p><strong>Customer:</strong> {{ order.user.name }}</p>
          <p><strong>Email:</strong> {{ order.user.email }}</p>
        </div>

        <div class="order-items">
          <h4>Items ({{ order.products.length }})</h4>
          <div class="item" *ngFor="let item of order.products">
            <div class="item-info">
              <span class="item-name">{{ item.product.name }}</span>
              <span class="item-quantity">x{{ item.quantity }}</span>
            </div>
            <span class="item-price">${{ (item.priceAtTime * item.quantity).toFixed(2) }}</span>
          </div>
        </div>

        <div class="order-address">
          <h4>Shipping Address</h4>
          <p>{{ order.shippingAddress.street }}</p>
          <p>{{ order.shippingAddress.city }}, {{ order.shippingAddress.state }} {{ order.shippingAddress.zipCode }}</p>
          <p>{{ order.shippingAddress.country }}</p>
        </div>

        <div class="order-footer">
          <div class="order-total">
            <strong>Total: ${{ order.total.toFixed(2) }}</strong>
          </div>
          <div class="order-actions">
            <button class="btn btn-primary btn-sm" (click)="viewOrder(order._id)">
              View Details
            </button>
            <select
              *ngIf="isAdmin()"
              [value]="order.status"
              (change)="updateOrderStatus(order._id, $event)"
              class="status-select"
            >
              <option value="pending">Pending</option>
              <option value="processing">Processing</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
              <option value="cancelled">Cancelled</option>
            </select>
            <button
              *ngIf="isAdmin()"
              class="btn btn-danger btn-sm"
              (click)="deleteOrder(order._id)"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #loadingTemplate>
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading orders...</p>
      </div>
    </ng-template>

    <div class="no-orders" *ngIf="!orderService.isLoading() && filteredOrders().length === 0">
      <h3>No orders found</h3>
      <p *ngIf="!isAdmin()">You haven't placed any orders yet.</p>
      <p *ngIf="isAdmin()">No orders match the current filters.</p>
      <a routerLink="/products" class="btn btn-primary" *ngIf="!isAdmin()">
        Start Shopping
      </a>
    </div>
  </div>
</div>
